<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1126px" preserveAspectRatio="none" style="width:1374px;height:1126px;" version="1.1" viewBox="0 0 1374 1126" width="1374px" zoomAndPan="magnify"><defs><filter height="300%" id="f19vjeut2ba3yu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="1006.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96.5" y="69.2969"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="829.2969"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="971.6953"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="1030.8281"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="184.4688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="533.2344"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="666.5" y="594.5"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="198.3359" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="804.5" y="159.6953"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="804.5" y="246.6328"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="194.4688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="999.5" y="317.7656"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1004.5" y="379.0313"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="34.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1250.5" y="462.9688"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1250.5" y="673.4375"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1320" y="912.5625"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="176.2031" style="stroke: #000000; stroke-width: 2.0;" width="257.5" x="752" y="113.5625"/><rect fill="#FFFFFF" height="86.9375" style="stroke: none; stroke-width: 1.0;" width="257.5" x="752" y="202.8281"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="172.3359" style="stroke: #000000; stroke-width: 2.0;" width="494.5" x="802" y="332.8984"/><rect fill="#FFFFFF" height="83.0703" style="stroke: none; stroke-width: 1.0;" width="494.5" x="802" y="422.1641"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="162.3359" style="stroke: #000000; stroke-width: 2.0;" width="699" x="597.5" y="548.3672"/><rect fill="#FFFFFF" height="73.0703" style="stroke: none; stroke-width: 1.0;" width="699" x="597.5" y="637.6328"/><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="459.5" y="717.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="466.5" y="737.6982">db: AppDatabase</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="293.5" y="763"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="300.5" y="782.9951">PfoertnerRepository</text><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="194.5313" style="stroke: #000000; stroke-width: 2.0;" width="1350.5" x="13" y="874.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="101" x2="101" y1="38.2969" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="371.5" x2="371.5" y1="795.6484" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="528.5" x2="528.5" y1="750.3516" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="666.5" x2="666.5" y1="38.2969" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="804" x2="804" y1="38.2969" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1004.5" x2="1004.5" y1="38.2969" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1255.5" x2="1255.5" y1="38.2969" y2="1085.9609"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1324.5" x2="1324.5" y1="38.2969" y2="1085.9609"/><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="30" y="22.9951">PfoertnerApplication</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="23" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="30" y="1104.9561">PfoertnerApplication</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="293.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="300.5" y="1104.9561">PfoertnerRepository</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="459.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="466.5" y="1104.9561">db: AppDatabase</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="607.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="614.5" y="22.9951">Authentication</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="607.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="614.5" y="1104.9561">Authentication</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="762" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="769" y="22.9951">Password</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="81" x="762" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="769" y="1104.9561">Password</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="979.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="986.5" y="22.9951">User</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="979.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="986.5" y="1104.9561">User</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1224.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1231.5" y="22.9951">Server</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="1224.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="1231.5" y="1104.9561">Server</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="1296.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1303.5" y="22.9951">Office</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="1296.5" y="1084.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="1303.5" y="1104.9561">Office</text><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="1006.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="96.5" y="69.2969"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="829.2969"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="971.6953"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="366.5" y="1030.8281"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="184.4688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="661.5" y="533.2344"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="666.5" y="594.5"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="198.3359" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="799.5" y="98.4297"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="804.5" y="159.6953"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="804.5" y="246.6328"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="194.4688" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="999.5" y="317.7656"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1004.5" y="379.0313"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="34.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1250.5" y="462.9688"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1250.5" y="673.4375"/><rect fill="#FFFFFF" filter="url(#f19vjeut2ba3yu)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1320" y="912.5625"/><ellipse cx="10.5" cy="68.5469" fill="none" rx="4" ry="4" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#A80036" points="84.5,65.2969,94.5,69.2969,84.5,73.2969,88.5,69.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="15" x2="90.5" y1="69.2969" y2="69.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="29" x="18" y="64.3638">init()</text><polygon fill="#A80036" points="787.5,94.4297,797.5,98.4297,787.5,102.4297,791.5,98.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="793.5" y1="98.4297" y2="98.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="113.5" y="93.4966">password = loadPassword()</text><path d="M752,113.5625 L816,113.5625 L816,120.5625 L806,130.5625 L752,130.5625 L752,113.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="176.2031" style="stroke: #000000; stroke-width: 2.0;" width="257.5" x="752" y="113.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="767" y="126.6294">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="831" y="125.7729">[password already exists]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="814.5" x2="856.5" y1="151.8281" y2="151.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856.5" x2="856.5" y1="151.8281" y2="164.8281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="815.5" x2="856.5" y1="164.8281" y2="164.8281"/><polygon fill="#A80036" points="825.5,160.8281,815.5,164.8281,825.5,168.8281,821.5,164.8281" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="821.5" y="146.7622">load from storage</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="752" x2="1009.5" y1="203.8281" y2="203.8281"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="757" y="214.0386">[otherwise]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="814.5" x2="856.5" y1="238.7656" y2="238.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856.5" x2="856.5" y1="238.7656" y2="251.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="815.5" x2="856.5" y1="251.7656" y2="251.7656"/><polygon fill="#A80036" points="825.5,247.7656,815.5,251.7656,825.5,255.7656,821.5,251.7656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="821.5" y="233.6997">generate random password</text><polygon fill="#A80036" points="987.5,313.7656,997.5,317.7656,987.5,321.7656,991.5,317.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="993.5" y1="317.7656" y2="317.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="113.5" y="312.8325">device = loadDevice(password)</text><path d="M802,332.8984 L866,332.8984 L866,339.8984 L856,349.8984 L802,349.8984 L802,332.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="172.3359" style="stroke: #000000; stroke-width: 2.0;" width="494.5" x="802" y="332.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="817" y="345.9653">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="179" x="881" y="345.1089">[device data already exists]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1014.5" x2="1056.5" y1="371.1641" y2="371.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1056.5" x2="1056.5" y1="371.1641" y2="384.1641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1015.5" x2="1056.5" y1="384.1641" y2="384.1641"/><polygon fill="#A80036" points="1025.5,380.1641,1015.5,384.1641,1025.5,388.1641,1021.5,384.1641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="1021.5" y="366.0981">load from storage</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="802" x2="1296.5" y1="423.1641" y2="423.1641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="807" y="433.3745">[otherwise]</text><polygon fill="#A80036" points="1238.5,458.9688,1248.5,462.9688,1238.5,466.9688,1242.5,462.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1009.5" x2="1244.5" y1="462.9688" y2="462.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="1016.5" y="458.0356">/devices(POST, body={password})</text><path d="M812,441.9688 L812,466.9688 L990,466.9688 L990,451.9688 L980,441.9688 L812,441.9688 " fill="#FBFB77" filter="url(#f19vjeut2ba3yu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M980,441.9688 L980,451.9688 L990,451.9688 L980,441.9688 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="818" y="459.0356">Registering a new device</text><polygon fill="#A80036" points="1020.5,493.1016,1010.5,497.1016,1020.5,501.1016,1016.5,497.1016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1014.5" x2="1254.5" y1="497.1016" y2="497.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="1026.5" y="492.1685">200 body={id: deviceId}</text><polygon fill="#A80036" points="649.5,529.2344,659.5,533.2344,649.5,537.2344,653.5,533.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="655.5" y1="533.2344" y2="533.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="113.5" y="528.3013">authentication = authenticate(device, password)</text><path d="M597.5,548.3672 L661.5,548.3672 L661.5,555.3672 L651.5,565.3672 L597.5,565.3672 L597.5,548.3672 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="162.3359" style="stroke: #000000; stroke-width: 2.0;" width="699" x="597.5" y="548.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="612.5" y="561.4341">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="370" x="676.5" y="560.5776">[authentication token already exists and has not expired]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="676.5" x2="718.5" y1="586.6328" y2="586.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="718.5" x2="718.5" y1="586.6328" y2="599.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="677.5" x2="718.5" y1="599.6328" y2="599.6328"/><polygon fill="#A80036" points="687.5,595.6328,677.5,599.6328,687.5,603.6328,683.5,599.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="683.5" y="581.5669">load from storage</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="597.5" x2="1296.5" y1="638.6328" y2="638.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="602.5" y="648.8433">[otherwise]</text><polygon fill="#A80036" points="1238.5,669.4375,1248.5,673.4375,1238.5,677.4375,1242.5,673.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="671.5" x2="1244.5" y1="673.4375" y2="673.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="678.5" y="668.5044">/devices/{deviceId}/authToken(POST, body={password})</text><polygon fill="#A80036" points="682.5,698.5703,672.5,702.5703,682.5,706.5703,678.5,702.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="676.5" x2="1254.5" y1="702.5703" y2="702.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="688.5" y="697.6372">200 body={id: authToken, ...}</text><polygon fill="#A80036" points="447.5,734.7031,457.5,738.7031,447.5,742.7031,451.5,738.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="453.5" y1="738.7031" y2="738.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="113.5" y="733.77">create</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="459.5" y="717.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="466.5" y="737.6982">db: AppDatabase</text><polygon fill="#A80036" points="281.5,780,291.5,784,281.5,788,285.5,784" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="287.5" y1="784" y2="784"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="113.5" y="779.0669">create(authToken, db)</text><rect fill="#FEFECE" filter="url(#f19vjeut2ba3yu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="293.5" y="763"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="300.5" y="782.9951">PfoertnerRepository</text><polygon fill="#A80036" points="354.5,825.2969,364.5,829.2969,354.5,833.2969,358.5,829.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="360.5" y1="829.2969" y2="829.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="113.5" y="824.3638">initStatus = getInitStatus()</text><path d="M13,874.4297 L83,874.4297 L83,881.4297 L73,891.4297 L13,891.4297 L13,874.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="194.5313" style="stroke: #000000; stroke-width: 2.0;" width="1350.5" x="13" y="874.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="28" y="887.4966">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="188" x="98" y="886.6401">[initStatus.hasJoinedOffice()]</text><polygon fill="#A80036" points="1308,908.5625,1318,912.5625,1308,916.5625,1312,912.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="1314" y1="912.5625" y2="912.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="113.5" y="907.6294">loadOffice(authentication)</text><polygon fill="#A80036" points="354.5,967.6953,364.5,971.6953,354.5,975.6953,358.5,971.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="360.5" y1="971.6953" y2="971.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="241" x="113.5" y="966.7622">refreshOffice(initStatus.joinedOfficeId)</text><polygon fill="#A80036" points="354.5,1026.8281,364.5,1030.8281,354.5,1034.8281,358.5,1030.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="106.5" x2="360.5" y1="1030.8281" y2="1030.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="113.5" y="1025.895">refreshAllLocalData()</text><!--
@startuml

participant "PfoertnerApplication" as App
participant "PfoertnerRepository" as Repo
participant "db: AppDatabase" as Db
participant "Authentication" as Auth

[o-> App : init()
activate App

App -> Password++: password = loadPassword()
alt password already exists
  Password -> Password++: load from storage
  deactivate Password
else otherwise
  Password -> Password++: generate random password
  deactivate Password
end
deactivate Password

App -> User++: device = loadDevice(password)
alt device data already exists
  User -> User++: load from storage
  deactivate User
else otherwise
  User -> Server++ : /devices(POST, body={password})
  note left: Registering a new device
  return 200 body={id: deviceId}
end
deactivate User

App -> Auth++: authentication = authenticate(device, password)
alt authentication token already exists and has not expired
  Auth -> Auth++: load from storage
  deactivate Auth
else otherwise
  Auth -> Server++ : /devices/{deviceId}/authToken(POST, body={password})
  return 200 body={id: authToken, ...}
end
deactivate Auth

App -> Db** : create
App -> Repo** : create(authToken, db)

App -> Repo++ : initStatus = getInitStatus()
deactivate Repo

opt initStatus.hasJoinedOffice()
  App -> Office++: loadOffice(authentication)
  deactivate Office
  App -> Repo++ : refreshOffice(initStatus.joinedOfficeId)
  deactivate Repo
  App -> Repo++ : refreshAllLocalData()
  deactivate Repo
end

deactivate App
@enduml

PlantUML version 1.2018.01(Sun Jan 28 19:08:22 CET 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_202-b26
Operating System: Linux
OS Version: 4.20.13-arch1-1-ARCH
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>